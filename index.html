<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EngageSense - Real-Time Engagement Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <script src="https://unpkg.com/meyda"></script>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Roboto', sans-serif;
        }
        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .scrollbar::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        .highlight {
            color: #3b82f6;
        }
        button:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4 scrollbar">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-white">EngageSense - Real-Time Analyzer</h1>
        <p class="text-gray-400">Analyze real-time audience engagement with AI</p>
    </header>

    <main class="container mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- File Upload & Recording Section -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg col-span-1 md:col-span-2">
            <h2 class="text-xl text-white font-semibold">Audio Input</h2>
            <p class="text-gray-400 mb-4">Upload an audio file or record in real-time.</p>
            <div class="space-y-4">
                <div id="waveform"></div>
                <input type="file" id="audioUpload" accept="audio/*" class="block w-full text-gray-300 bg-gray-700 p-2 rounded-lg" aria-label="Upload audio file" />
                <button id="analyzeButton" class="bg-green-600 text-white px-4 py-2 rounded-lg w-full" aria-label="Analyze audio">Analyze Audio</button>
                <button id="recordButton" class="bg-blue-600 text-white px-4 py-2 rounded-lg w-full" aria-label="Start recording audio">Start Recording</button>
                <button id="stopButton" class="bg-red-600 text-white px-4 py-2 rounded-lg w-full hidden" aria-label="Stop recording audio">Stop Recording</button>
                <audio id="audioPreview" controls class="w-full hidden" aria-label="Audio playback preview"></audio>
            </div>
        </div>

        <!-- Engagement Levels Visualization -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg col-span-1">
            <h2 class="text-xl text-white font-semibold">Engagement Levels</h2>
            <div class="chart-container">
                <canvas id="engagementChart"></canvas>
            </div>
        </div>

        <!-- Overall Engagement Visualization -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg col-span-1">
            <h2 class="text-xl text-white font-semibold">Overall Engagement</h2>
            <canvas id="overallEngagementChart" class="w-full mt-4"></canvas>
            <p id="overallEngagementScore" class="text-3xl font-bold text-blue-400 mt-4 text-center">0</p>
        </div>

        <!-- Engagement Trends Visualization -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg col-span-1 md:col-span-2">
            <h2 class="text-xl text-white font-semibold">Engagement Trends</h2>
            <canvas id="engagementTrendsChart" class="w-full mt-4"></canvas>
        </div>

        <!-- Recommendations -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg col-span-1">
            <h2 class="text-xl text-white font-semibold">Recommendations</h2>
            <ul id="recommendationsContainer" class="mt-4 text-gray-300">
                <li>Loading recommendations...</li>
            </ul>
        </div>
    </main>

    <footer class="text-center mt-10">
        <p class="text-gray-500 text-sm">&copy; 2024 EngageSense. All Rights Reserved.</p>
    </footer>

    <script>
        // Initialize WaveSurfer.js
        const wavesurfer = WaveSurfer.create({
            container: '#waveform',
            waveColor: '#007BFF',
            progressColor: '#0056b3',
            responsive: true,
            height: 100,
        });

        document.getElementById('audioUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                wavesurfer.load(url);
            }
        });

        // Initialize Meyda Analyzer
        let analyzer;
        wavesurfer.on('ready', () => {
            const audioContext = wavesurfer.backend.ac;
            const source = wavesurfer.backend.media;
            analyzer = Meyda.createMeydaAnalyzer({
                audioContext,
                source,
                bufferSize: 512,
                featureExtractors: ['rms', 'spectralCentroid', 'zcr'],
                callback: (features) => {
                    console.log('Features:', features);
                },
            });
        });

        document.getElementById('analyzeButton').addEventListener('click', () => {
            if (analyzer) {
                analyzer.start();
                setTimeout(() => {
                    analyzer.stop();
                }, 5000); // Analyze for 5 seconds
            } else {
                alert('Please load an audio file first.');
            }
        });
    </script>
</body>
</html>
